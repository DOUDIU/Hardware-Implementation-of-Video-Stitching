
/*******************************MILIANKE*******************************
*Company : MiLianKe Electronic Technology Co., Ltd.
*WebSite:https://www.milianke.com
*TechWeb:https://www.uisrc.com
*tmall-shop:https://milianke.tmall.com
*jd-shop:https://milianke.jd.com
*taobao-shop1: https://milianke.taobao.com
*Create Date: 2019/12/17
*Module Name:uivtc(video timing controller)
*File Name:
*Description: 
*The reference demo provided by Milianke is only used for learning. 
*We cannot ensure that the demo itself is free of bugs, so users 
*should be responsible for the technical problems and consequences
*caused by the use of their own products.
*Copyright: Copyright (c) MiLianKe
*All rights reserved.
*Revision: 1.1
*Signal description
*1) _i input
*2) _o output
*3) _n activ low
*4) _dg debug signal 
*5) _r delay or register
*6) _s state mechine
*********************************************************************/

/*************uivtc(video timing controller)è§†é¢‘æ—¶åºæ§åˆ¶å™?*************
--ç‰ˆæœ¬å?1.1
--ä»¥ä¸‹æ˜¯ç±³è”å®¢è®¾è®¡çš„uivtc(video timing controller)è§†é¢‘æ—¶åºæ§åˆ¶å™?
--1.ä»£ç ç®?æ´ï¼Œå ç”¨æå°‘é€»è¾‘èµ„æºï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘è®¾è®¡ä¸¥è°¨
--2.ä½¿ç”¨æ–¹ä¾¿ï¼Œåªéœ?è¦è¾“å…?6ä¸ªå‚æ•°æ—¢å¯ä»¥å®ç°å¯¹ä¸åŒè§†é¢‘åˆ†è¾¨ç‡æ—¶åºçš„æ§åˆ?
--3.è¯¥è§†é¢‘æ—¶åºæ§åˆ¶ï¼Œä¸?ä¸ªæ—¶é’Ÿå¯¹åº”ä¸€ä¸ªåƒç´?
--4.é€šå¸¸æˆ‘ä»¬è¯´çš„åƒç´ ï¼Œæ¯”å¦?1080Pä»£è¡¨äº?1920*1080æ˜¯æŒ‡è§†é¢‘çš„æœ‰æ•ˆæ˜¾ç¤ºåŒºåŸŸï¼Œå®é™…çš„è§†é¢‘è¿˜åŒ…å«ä¸èƒ½æ˜¾ç¤ºçš„åŒºåŸŸï¼Œæ¯”å¦‚è¡ŒåŒæ­¥ï¼ŒåœºåŒæ­¥æ—¶é—?
--5.é€šå¸¸æˆ‘ä»¬è¯´çš„è¡Œè§†é¢‘ä¿¡å·ï¼Œä¹Ÿç§°ä¹‹ä¸ºè§†é¢‘çš„æ°´å¹³åƒç´ ä¿¡å·ï¼›åœºè§†é¢‘ä¿¡å·ï¼Œä¹Ÿç§°ä¹‹ä¸ºè§†é¢‘çš„å‚ç›´åƒç´ ä¿¡å·ï¼›
*********************************************************************/

`timescale 1ns / 1ns //ä»¿çœŸæ—¶é—´åˆ»åº¦/ç²¾åº¦

module uivtc#(
//    parameter H_ActiveSize  =   1920,               //è§†é¢‘æ—¶é—´å‚æ•°,è¡Œè§†é¢‘ä¿¡å·ï¼Œä¸?è¡Œæœ‰æ•?(éœ?è¦æ˜¾ç¤ºçš„éƒ¨åˆ†)åƒç´ æ‰?å çš„æ—¶é’Ÿæ•°ï¼Œä¸?ä¸ªæ—¶é’Ÿå¯¹åº”ä¸€ä¸ªæœ‰æ•ˆåƒç´?
//    parameter H_FrameSize   =   1920+88+44+148,     //è§†é¢‘æ—¶é—´å‚æ•°,è¡Œè§†é¢‘ä¿¡å·ï¼Œä¸?è¡Œè§†é¢‘ä¿¡å·æ?»è®¡å ç”¨çš„æ—¶é’Ÿæ•°
//    parameter H_SyncStart   =   1920+88,            //è§†é¢‘æ—¶é—´å‚æ•°,è¡ŒåŒæ­¥å¼€å§‹ï¼Œå³å¤šå°‘æ—¶é’Ÿæ•°åå¼€å§‹äº§ç”Ÿè¡ŒåŒæ­¥ä¿¡å· 
//    parameter H_SyncEnd     =   1920+88+44,         //è§†é¢‘æ—¶é—´å‚æ•°,è¡ŒåŒæ­¥ç»“æŸï¼Œå³å¤šå°‘æ—¶é’Ÿæ•°ååœæ­¢äº§ç”Ÿè¡ŒåŒæ­¥ä¿¡å·ï¼Œä¹‹åå°±æ˜¯è¡Œæœ‰æ•ˆæ•°æ®éƒ¨åˆ†

//    parameter V_ActiveSize  =   1080,               //è§†é¢‘æ—¶é—´å‚æ•°,åœºè§†é¢‘ä¿¡å·ï¼Œä¸?å¸§å›¾åƒæ‰€å ç”¨çš„æœ‰æ•?(éœ?è¦æ˜¾ç¤ºçš„éƒ¨åˆ†)è¡Œæ•°é‡ï¼Œé€šå¸¸è¯´çš„è§†é¢‘åˆ†è¾¨ç‡å³H_ActiveSize*V_ActiveSize
//    parameter V_FrameSize   =   1080+4+5+36,        //è§†é¢‘æ—¶é—´å‚æ•°,åœºè§†é¢‘ä¿¡å·ï¼Œä¸?å¸§è§†é¢‘ä¿¡å·æ?»è®¡å ç”¨çš„è¡Œæ•°é‡
//    parameter V_SyncStart   =   1080+4,             //è§†é¢‘æ—¶é—´å‚æ•°,åœºåŒæ­¥å¼€å§‹ï¼Œå³å¤šå°‘è¡Œæ•°åå¼?å§‹äº§ç”ŸåœºåŒæ­¥ä¿¡å· 
//    parameter V_SyncEnd     =   1080+4+5            //è§†é¢‘æ—¶é—´å‚æ•°,åœºåŒæ­¥ç»“æŸï¼Œå³å¤šå°‘åœºæ•°ååœæ­¢äº§ç”ŸåœºåŒæ­¥ä¿¡å·ï¼Œä¹‹åå°±æ˜¯åœºæœ‰æ•ˆæ•°æ®éƒ¨åˆ?
    parameter H_ActiveSize  =   1280,               //è§†é¢‘æ—¶é—´å‚æ•°,è¡Œè§†é¢‘ä¿¡å·ï¼Œä¸?è¡Œæœ‰æ•?(éœ?è¦æ˜¾ç¤ºçš„éƒ¨åˆ†)åƒç´ æ‰?å çš„æ—¶é’Ÿæ•°ï¼Œä¸?ä¸ªæ—¶é’Ÿå¯¹åº”ä¸€ä¸ªæœ‰æ•ˆåƒç´?
    parameter H_FrameSize   =   1280+40+110+220,     //è§†é¢‘æ—¶é—´å‚æ•°,è¡Œè§†é¢‘ä¿¡å·ï¼Œä¸?è¡Œè§†é¢‘ä¿¡å·æ?»è®¡å ç”¨çš„æ—¶é’Ÿæ•°
    parameter H_SyncStart   =   1280+40,            //è§†é¢‘æ—¶é—´å‚æ•°,è¡ŒåŒæ­¥å¼€å§‹ï¼Œå³å¤šå°‘æ—¶é’Ÿæ•°åå¼€å§‹äº§ç”Ÿè¡ŒåŒæ­¥ä¿¡å· 
    parameter H_SyncEnd     =   1280+40+110,         //è§†é¢‘æ—¶é—´å‚æ•°,è¡ŒåŒæ­¥ç»“æŸï¼Œå³å¤šå°‘æ—¶é’Ÿæ•°ååœæ­¢äº§ç”Ÿè¡ŒåŒæ­¥ä¿¡å·ï¼Œä¹‹åå°±æ˜¯è¡Œæœ‰æ•ˆæ•°æ®éƒ¨åˆ†

    parameter V_ActiveSize  =   720,               //è§†é¢‘æ—¶é—´å‚æ•°,åœºè§†é¢‘ä¿¡å·ï¼Œä¸?å¸§å›¾åƒæ‰€å ç”¨çš„æœ‰æ•?(éœ?è¦æ˜¾ç¤ºçš„éƒ¨åˆ†)è¡Œæ•°é‡ï¼Œé€šå¸¸è¯´çš„è§†é¢‘åˆ†è¾¨ç‡å³H_ActiveSize*V_ActiveSize
    parameter V_FrameSize   =   720+5+5+20,        //è§†é¢‘æ—¶é—´å‚æ•°,åœºè§†é¢‘ä¿¡å·ï¼Œä¸?å¸§è§†é¢‘ä¿¡å·æ?»è®¡å ç”¨çš„è¡Œæ•°é‡
    parameter V_SyncStart   =   720+5,             //è§†é¢‘æ—¶é—´å‚æ•°,åœºåŒæ­¥å¼€å§‹ï¼Œå³å¤šå°‘è¡Œæ•°åå¼?å§‹äº§ç”ŸåœºåŒæ­¥ä¿¡å· 
    parameter V_SyncEnd     =   720+5+5            //è§†é¢‘æ—¶é—´å‚æ•°,åœºåŒæ­¥ç»“æŸï¼Œå³å¤šå°‘åœºæ•°ååœæ­¢äº§ç”ŸåœºåŒæ­¥ä¿¡å·ï¼Œä¹‹åå°±æ˜¯åœºæœ‰æ•ˆæ•°æ®éƒ¨åˆ?
)(
    input           vtc_rstn_i,//ç³»ç»Ÿå¤ä½
    input			vtc_clk_i, //ç³»ç»Ÿæ—¶é’Ÿ
    output	reg		vtc_vs_o,  //åœºåŒæ­¥è¾“å‡?
    output  reg     vtc_hs_o,  //è¡ŒåŒæ­¥è¾“å‡?
    output  reg     vtc_de_o   //è§†é¢‘æ•°æ®æœ‰æ•ˆ	 
);

reg [11:0] hcnt = 12'd0;    //è§†é¢‘æ°´å¹³æ–¹å‘ï¼Œåˆ—è®¡æ•°å™¨ï¼Œå¯„å­˜å™?
reg [11:0] vcnt = 12'd0;    //è§†é¢‘å‚ç›´æ–¹å‘ï¼Œè¡Œè®¡æ•°å™¨ï¼Œå¯„å­˜å™?   
reg [2 :0] rst_cnt = 3'd0;  //å¤ä½è®¡æ•°å™¨ï¼Œå¯„å­˜å™?
wire rst_sync = rst_cnt[2]; //åŒæ­¥å¤ä½

always @(posedge vtc_clk_i or negedge vtc_rstn_i)begin //é€šè¿‡è®¡æ•°å™¨äº§ç”ŸåŒæ­¥å¤ä½?
    if(vtc_rstn_i == 1'b0)
        rst_cnt <= 3'd0;
    else if(rst_cnt[2] == 1'b0)
        rst_cnt <= rst_cnt + 1'b1;
end    

//è§†é¢‘æ°´å¹³æ–¹å‘ï¼Œåˆ—è®¡æ•°å™?
always @(posedge vtc_clk_i)begin
    if(rst_sync == 1'b0) //å¤ä½
        hcnt <= 12'd0;
    else if(hcnt < (H_FrameSize - 1'b1))//è®¡æ•°èŒƒå›´ä»?0 ~ H_FrameSize-1
        hcnt <= hcnt + 1'b1;
    else 
        hcnt <= 12'd0;
end         

//è§†é¢‘å‚ç›´æ–¹å‘ï¼Œè¡Œè®¡æ•°å™¨ï¼Œç”¨äºè®¡æ•°å·²ç»å®Œæˆçš„è¡Œè§†é¢‘ä¿¡å·
always @(posedge vtc_clk_i)begin
    if(rst_sync == 1'b0)
        vcnt <= 12'd0;
    else if(hcnt == (H_ActiveSize  - 1'b1)) begin//è§†é¢‘æ°´å¹³æ–¹å‘ï¼Œæ˜¯å¦ä¸€è¡Œç»“æ?
           vcnt <= (vcnt == (V_FrameSize - 1'b1)) ? 12'd0 : vcnt + 1'b1;//è§†é¢‘å‚ç›´æ–¹å‘ï¼Œè¡Œè®¡æ•°å™¨åŠ 1ï¼Œè®¡æ•°èŒƒå›?0~V_FrameSize - 1
    end
end 

wire hs_valid  =  hcnt < H_ActiveSize; //è¡Œä¿¡å·æœ‰æ•ˆåƒç´ éƒ¨åˆ?
wire vs_valid  =  vcnt < V_ActiveSize; //åœºä¿¡å·æœ‰æ•ˆåƒç´ éƒ¨åˆ?
wire vtc_hs   =  (hcnt >= H_SyncStart && hcnt < H_SyncEnd);//äº§ç”Ÿhsï¼Œè¡ŒåŒæ­¥ä¿¡å·
wire vtc_vs	   = (vcnt > V_SyncStart && vcnt <= V_SyncEnd);//äº§ç”Ÿvsï¼ŒåœºåŒæ­¥ä¿¡å·      
wire vtc_de   =  hs_valid && vs_valid;//åªæœ‰å½“è§†é¢‘æ°´å¹³æ–¹å‘ï¼Œåˆ—æœ‰æ•ˆå’Œè§†é¢‘å‚ç›´æ–¹å‘ï¼Œè¡ŒåŒæ—¶æœ‰æ•ˆï¼Œè§†é¢‘æ•°æ®éƒ¨åˆ†æ‰æ˜¯æœ‰æ•?

//å®Œä¸€æ¬¡å¯„å­˜æ‰“æ‹è¾“å‡ºï¼Œæœ‰åˆ©äºæ”¹å–„æ—¶åºï¼Œå°¤å…¶å¯¹äºé«˜åˆ†è¾¨ç‡ï¼Œé«˜é€Ÿçš„ä¿¡å·ï¼Œæ‰“æ‹å¯ä»¥æ”¹å–„å†…éƒ¨æ—¶åºï¼Œä»¥è¿è¡Œäºæ›´é«˜é€Ÿåº¦
always @(posedge vtc_clk_i)begin
	if(rst_sync == 1'b0)begin
		vtc_vs_o <= 1'b0;
		vtc_hs_o <= 1'b0;
		vtc_de_o <= 1'b0;
	end
	else begin
		vtc_vs_o <= vtc_vs; //åœºåŒæ­¥ä¿¡å·æ‰“æ‹è¾“å‡?
		vtc_hs_o <= vtc_hs; //è¡ŒåŒæ­¥ä¿¡å·æ‰“æ‹è¾“å‡?
		vtc_de_o <= vtc_de;	//è§†é¢‘æœ‰æ•ˆä¿¡å·æ‰“æ‹è¾“å‡º
	end
end

endmodule


